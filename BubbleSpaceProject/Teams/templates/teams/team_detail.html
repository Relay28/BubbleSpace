{% extends "base.html" %}

{% block content %}
<style>
    /* Buttons */
    .btn-back,
    .btn-primary,
    .btn-secondary,
    .btn-warning,
    .btn-danger {
        border-radius: 8px;
        font-size: 0.9rem;
        padding: 8px 12px;
        text-decoration: none;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .btn-back:hover,
    .btn-primary:hover,
    .btn-secondary:hover,
    .btn-warning:hover,
    .btn-danger:hover {
        transform: translateY(-3px);
    }
    .table th,
    .table td {
        vertical-align: middle;
        text-align: center; /* Align actions column content */
    }

    .table-actions {
        text-align: center;
    }

    .btn-link {
        padding: 0;
        font-size: 1.2rem; /* Adjust icon size */
    }
    /* Project Cards */
    .tab-content {
        min-height: 300px; /* Set a consistent minimum height for the tab content */
    }

    .project-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }

    .no-projects {
        text-align: center;
        font-size: 1rem;
        color: var(--text-muted-color);
        margin-top: 20px;
    }

    .project-card {
        background-color: var(--card-bg-color);
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .project-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }

    .project-header {
        font-weight: 600;
        color: var(--text-color);
        font-size: 1.1rem;
        margin-bottom: 8px;
    }

    .project-status {
        font-size: 0.9rem;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 12px;
        display: inline-block;
        text-transform: uppercase;
    }

    .status-ongoing {
        background-color: var(--warning-color);
        color: white;
    }

    .status-completed {
        background-color: var(--success-color);
        color: white;
    }

    .status-cancelled {
        background-color: var(--danger-color);
        color: white;
    }

    .status-pending {
        background-color: var(--muted-color);
        color: white;
    }

    .project-actions {
        margin-top: 15px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    /* Tab Styles */
    .nav-tabs .nav-link {
        color: var(--text-color);
        font-weight: 500;
        border: none;
        background-color: transparent;
        transition: color 0.3s ease;
    }

    .nav-tabs .nav-link:hover {
        color: var(--primary-color);
    }

    .nav-tabs .nav-link.active {
        color: var(--active-tab-color);
        font-weight: 600;
        border-bottom: 2px solid var(--primary-color);
    }

    /* Member Role Styling */
    .badge-role {
        font-size: 0.9rem;
        padding: 5px 8px;
        border-radius: 12px;
        color: var(--text-color); /* Ensures the text color is readable */
    }

    .badge-owner {
        background-color: #007bff;
        color: white;
    }

    .badge-member {
        background-color: #6c757d;
        color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .project-list {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- Back Button -->
<div class="mb-4">
    <a href="{% url 'team_list' %}" class="btn-back btn-primary">
        <i class="bi bi-arrow-left"></i> Back
    </a>
</div>

<!-- Team Name and Edit Button -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h4 text-primary m-0">{{ team.team_name }}</h1>
    {% if request.user == team.creator %}
    <a href="{% url 'team_edit' team.pk %}" class="btn btn-warning btn-sm">
        <i class="bi bi-pencil"></i> Edit
    </a>
    {% endif %}
</div>
<!-- Members Section -->
<!-- Members Section -->
<section class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 text-primary m-0">Members</h2>
        <a href="{% url 'add_team_member' team.pk %}" class="btn btn-primary btn-sm">
            <i class="bi bi-person-plus"></i> Add Member
        </a>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th class="table-actions">Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Display Team Owner First -->
                <tr>
                    <td>{{ team.creator.fname }} {{ team.creator.lname }}</td>
                    <td>
                        <span class="badge badge-role badge-owner">Owner</span>
                    </td>
                    <td class="table-actions">
                        {% if request.user == team.creator %}
                        <!-- Display "Transfer Ownership" action for the owner -->
                        <a href="{% url 'leave_team' team.pk %}" 
                        class="btn btn-link text-danger" 
                        title="Leave Team">
                        <i class="bi bi-box-arrow-left"></i> 
                       </a>
                        {% endif %}
                    </td>
                </tr>

                <!-- Display Other Members -->
                {% for member in members %}
                {% if member != team.creator %}
                <tr>
                    <td>{{ member.fname }} {{ member.lname }}</td>
                    <td>
                        <span class="badge badge-role badge-member">Member</span>
                    </td>
                    <td class="table-actions">
                        {% if request.user == team.creator %}
                        <!-- Action for Owner: Transfer Ownership or Remove Member -->
                        <a href="{% url 'transfer_ownership' team.pk member.pk %}" 
                            class="btn btn-link text-warning" 
                            title="Transfer Ownership">
                            <i class="bi bi-shield-fill"></i> 
                        </a>
                        <a href="{% url 'remove_team_member' team.pk member.pk %}" 
                            class="btn btn-link text-danger" 
                            title="Remove Member">
                            <i class="bi bi-trash"></i>
                        </a>
                        {% elif request.user == member %}
                        <!-- Action for Member: Leave Team -->
                        <a href="{% url 'leave_team' team.pk %}" 
                            class="btn btn-link text-danger" 
                            title="Leave Team">
                            <i class="bi bi-box-arrow-left"></i> 
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>


<!-- Projects Section -->
<section>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 text-primary m-0">Projects</h2>
        <a href="{% url 'project_create' team.pk %}" class="btn btn-primary btn-sm">
            <i class="bi bi-folder-plus"></i> Add Project
        </a>
    </div>

    <!-- Tabs for Project Status -->
    <ul class="nav nav-tabs" id="projectTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">
                Pending
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="ongoing-tab" data-bs-toggle="tab" data-bs-target="#ongoing" type="button" role="tab" aria-controls="ongoing" aria-selected="false">
                Ongoing
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="cancelled-tab" data-bs-toggle="tab" data-bs-target="#cancelled" type="button" role="tab" aria-controls="cancelled" aria-selected="false">
                Cancelled
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab" aria-controls="completed" aria-selected="false">
                Completed
            </button>
        </li>
    </ul>

    <div class="tab-content" id="projectTabContent">
        <!-- Pending Tab -->
        <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
            <div class="project-list mt-3">
                {% for project in projects %}
                {% if project.Status == 'Pending' %}
                <div class="project-card">
                    <div class="project-header">{{ project.Title }}</div>
                    <div class="project-status status-pending">{{ project.Status }}</div>
                    <div class="project-actions">
                        <a href="{% url 'project_detail' project.ProjectId %}" class="btn btn-secondary btn-sm">
                            <i class="bi bi-info-circle"></i> Details
                        </a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Ongoing Tab -->
        <div class="tab-pane fade" id="ongoing" role="tabpanel" aria-labelledby="ongoing-tab">
            <div class="project-list mt-3">
                {% for project in projects %}
                {% if project.Status == 'Ongoing' %}
                <div class="project-card">
                    <div class="project-header">
                        <a href="{% url 'project_tasks' project.ProjectId %}" class="text-decoration-none text-reset">
                            {{ project.Title }}
                        </a>
                    </div>
                    <div class="project-status status-ongoing">{{ project.Status }}</div>
                    <div class="project-actions">
                        <a href="{% url 'project_detail' project.ProjectId %}" class="btn btn-secondary btn-sm">
                            <i class="bi bi-info-circle"></i> Details
                        </a>
                        <a href="{% url 'project_tasks' project.ProjectId %}" class="btn btn-primary btn-sm">
                            <i class="bi bi-list-check"></i> Tasks
                        </a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Cancelled Tab -->
        <div class="tab-pane fade" id="cancelled" role="tabpanel" aria-labelledby="cancelled-tab">
            <div class="project-list mt-3">
                {% for project in projects %}
                {% if project.Status == 'Cancelled' %}
                <div class="project-card">
                    <div class="project-header">
                        <a href="{% url 'project_tasks' project.ProjectId %}" class="text-decoration-none text-reset">
                            {{ project.Title }}
                        </a>
                    </div>
                    <div class="project-status status-completed">{{ project.Status }}</div>
                    <div class="project-actions">
                        <a href="{% url 'project_detail' project.ProjectId %}" class="btn btn-secondary btn-sm">
                            <i class="bi bi-info-circle"></i> Details
                        </a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Completed Tab -->
        <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
            <div class="project-list mt-3">
                {% for project in projects %}
                {% if project.Status == 'Completed' %}
                <div class="project-card">
                    <div class="project-header">
                        <a href="{% url 'project_tasks' project.ProjectId %}" class="text-decoration-none text-reset">
                            {{ project.Title }}
                        </a>
                    </div>
                    <div class="project-status status-completed">{{ project.Status }}</div>
                    <div class="project-actions">
                        <a href="{% url 'project_detail' project.ProjectId %}" class="btn btn-secondary btn-sm">
                            <i class="bi bi-info-circle"></i> Details
                        </a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</section>

{% endblock %}
