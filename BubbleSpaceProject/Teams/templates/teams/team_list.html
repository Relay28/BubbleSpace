{% extends "base.html" %}

{% block content %}
<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Your Teams</h1>
        <!-- Create/Join Team Button -->
        <button class="btn btn-success d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#createTeamModal">
            <i class="bi bi-plus-circle me-2"></i> Join or Create Team
        </button>
    </div>

    <!-- Teams Card Layout -->
    <div class="row gy-4">
        {% for team in teams %}
        <div class="col-md-4 col-lg-3">
            <!-- Clickable Card -->
            <div class="card shadow-sm border-0 h-100 clickable-card">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <button class="btn btn-sm btn-outline-secondary p-0 d-flex align-items-center" onclick="toggleOptions(this); event.stopPropagation();">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <!-- Delete Button Shown When Options Clicked -->
                    <div class="delete-form position-absolute" style="display: none; z-index: 10; left: 1rem; top: 2.5rem;">
                        <button 
                            class="btn btn-danger btn-sm" 
                            onclick="openDeleteModal('{{ team.pk }}', '{{ team.team_name|escapejs }}'); event.stopPropagation();">
                            <i class="bi bi-trash3 me-1"></i> Delete
                        </button>
                    </div>
                </div>
                <!-- Team Name Section as Clickable -->
                <a href="{% url 'team_detail' team.pk %}" class="text-decoration-none">
                    <div class="card-body d-flex justify-content-center align-items-center clickable-section">
                        <h5 class="card-title text-center mb-0 text-dark" title="{{ team.team_name }}">{{ team.team_name }}</h5>
                    </div>
                </a>
            </div>
        </div>
        {% empty %}
        <p class="text-muted text-center">No teams found. Create or join a team to get started!</p>
        {% endfor %}
    </div>
</div>

<!-- Modal for Create Team -->
<div id="createTeamModal" class="modal fade" tabindex="-1" aria-labelledby="createTeamModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createTeamModalLabel">Create a New Team</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'team_create' %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-check-circle me-2"></i> Create
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Confirm Deletion -->
<div id="deleteTeamModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the team "<span id="deleteTeamName"></span>"?</p>
                <form id="deleteTeamForm" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger w-100">
                        <i class="bi bi-trash3 me-2"></i> Yes, Delete
                    </button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle the delete menu for the team
    function toggleOptions(button) {
        const deleteForm = button.nextElementSibling;
        deleteForm.style.display = deleteForm.style.display === 'none' ? 'block' : 'none';
    }

    // Open delete modal and populate it with team details
    function openDeleteModal(teamId, teamName) {
        const modal = new bootstrap.Modal(document.getElementById('deleteTeamModal'));
        document.getElementById('deleteTeamName').textContent = teamName;
        const deleteForm = document.getElementById('deleteTeamForm');
        deleteForm.action = `{% url 'team_delete' 0 %}`.replace('0', teamId);
        modal.show();
    }
</script>
{% endblock %}
    